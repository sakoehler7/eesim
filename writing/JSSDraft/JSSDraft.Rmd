---
author:
  - name: Sarah Koehler
    affiliation: Colorado State University
    address: >
      Lake Street
      Fort Collins, CO
    email: sakoehler7@gmail.com
  - name: G. Brooke Anderson
    affiliation: Colorado State University
    address: >
      Lake Street
      Fort Collins, CO
    email: brooke.anderson@colostate.edu
title:
  formatted: "\\pkg{eesim}: An R Package to Simulate Environmental Epidemiology Time Series for Simulation Studies and Power Analyses"
  # If you use tex in the formatted title, also supply version without
  plain:     "eesim: An R Package to Simulate Environmental Epidemiology Time Series for Simulation Studies and Power Analyses"
  # For running headers, if needed
  short:     "\\pkg{eesim}: Simulations for Environmental Epidemiology"
abstract: >
  Simulation studies are important in environmental epidemiology research on air pollution, temperature, and other exposures. For example, studies have simulated time series of environmental exposure and health outcome data to compare time series and case-crossover methods; explore models to test for mortality-displacement; investigate the impacts of measurement error and spatial misalignment of exposure and outcome measurements; and search for confounding by other time-varying covariates. 
  
  Developing the code to simulate environmental time series for these types of studies can be time consuming, and simulation methods have varied across previous simulation studies, complicating the comparison of results across different studies. Here, we present an R package that automates simulation of environmental time series for such simulations, offering both sensible defaults for each stage of the simulation process and also the option to customize any of the simulation steps while using defaults for any steps that do not require customization. This packge can be used to aid simulation studies to explore environmental epidemiology models relating acute health outcomes and daily environmental exposures; it can also be used to estimate the power of studies when planning or proposing future research.
keywords:
  # at least one keyword must be supplied
  formatted: [R, environmental epidemiology, simulation studies, power analysis, air pollution]
  plain:     [R, environmental epidemiology, simulation studies, power analysis, air pollution]
preamble: >
  \usepackage{amsmath}
output:
  rticles::jss_article:
    citation_package: natbib
bibliography: mybibfile.bib
---

# Introduction

## Environmental time series studies and why they're important

## Using simulated time series for power analysis

## Using simulated time series to test modeling questions

## Challenges in creating simulated time series

For many environmental time series studies, including those investigating air pollution and temperature, both exposures and outcomes can have complex seasonal and longer-term patterns over the study period. For example, air pollution concentrations can change seasonally, both because of changes in emission patterns and meteorological patterns (for example, winter inversion layers can cause a build-up of particulate matter in the winter, while high temperatures in the summer can accelate ozone formation from precursors); air pollution concentrations can also change over years, especially with evolving Clean Air policies.

Exposures, outcomes, and their relationship with each other can all have complex patterns that could cause problems in epidemiological studies. For example, \citet{Armstrong2014} explain how autocorrelation in temperature data (e.g., days right after a very severe heat wave are likely to be hotter than days right after a milder heat wave) can introduce spurious results in a model testing for evidence of short-term mortality displacement following heat waves.

There are a few important advantages to having an open-source software package that can simulate this type of environmental time series for simulation studies. First, current methods of simulating environmental time series, to use to assess modeling choices, vary across different studies. While, ideally, results from a simulation study would be robust to different choices in how to simulate the data used in the study, this may not always be the case; if so, results across studies using different methods of simulating data would not be comparable. This package offers a tool that both allows different research to simulate environmental time series for simulation studies in a consistent way, it also offers several methods of simulating time series, and so allows researchers to check if simulation results are sensitive to the method of simulating study data. Tools for consistency across studies have helped in the progress of environmental epidemiology research; for example, the public availability of the NMMAPs dataset--which included air pollution, weather, and mortality counts in over 100 US communities for 14 years-- allowed researchers around the world to explore hypotheses and investigate health effects of air pollution and temperature using the same data, and so differences in results could be traced to methodological differences rather than random differences in environmental datasets. [We could add some on the usefulness of (1) reproducible studies and (2) open source software for scientific studies here.]

Further, developing the code to simulate environmental time series in an appropriate way can be time consuming. While researchers often need to customize certain parts of a simulation, to test a particular research question, often most of the simulation can be performed in a way that is generalizable across most other environmental time series studies. Therefore, by providing simulation tools with reasonable defaults, as well as room to customize at each step of the simulation, this package can make environmental epidemiolgoy simulation studies much more efficient and also make simulation a reasonable alternative for determining expected power when planning and proposing future studies.

# Examples of studies that simulated environmental time series

## Mortality displacement

\citet{Armstrong2014} used a simulation study to investigate whether evidence of short-term mortality displacement following heat waves was a result of model artifacts. To do this, they aimed to simulate a time series of heat wave (binary) effects with heat wave effects, none of which were caused by short-term mortality displacement. They then showed that, when they fit the model from the previous study to this simulated dataset, the model generated results suggestive of short-term mortality displacement, and less displacement with more severe heat waves than less severe heat waves, which were similar to the findings of the study they were assessing. Overall, this analysis suggested that the earlier study's results might have been an artifact of the modeling approach they used, and so their results could be consistent with a hypothesis of no mortality displacement.

To do this simulation, which required simulating a time series with a heat wave effect on mortality, but no short-term displacement to explain some of that excess mortality, \citet{Armstrong2014} started with a real dataset of daily temperature and mortality counts. For this, they used the NMMAPS dataset (1987--2000) from Atlanta, GA, which was one of the datasets used in the original study. They fit a model of expected log mortality count for this real data regressed on daily (lag 0) temperature and a smooth function of time (to capture seasonal and long-term variation). They then predicted from this model for the days in their simulation, to generate a smoothed estimate of expected daily mortality on each day (note: this daily expected count is a function of observed temperature over the study period; it sounds like they used observed data directly for the exposure time series). They then drew simulated daily mortality counts from a Poisson distribution with $\lambda$ equal to this daily expected mean mortality for each day in the simulation period. [Code they used for this simulation analysis is available as an online supplement.]

## Comparing case-crossover and time series

## Investigating confounding

## Exploring spatial misalignment between exposure and outcome measurements

# Basic overview of package

# Implementing the package

## Simulating time series

## Using simulated time series for power analysis

## Using simulated time series to test modeling questions

## Evaluating simulations based on these time series

## Customizing simulations

# Discussion

# Acknowledgments

# References
