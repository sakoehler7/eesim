---
title: "Using `eesim`"
author: "Sarah Koehler and Brooke Anderson"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, echo = FALSE}
library(eesim)
library(ggplot2)
```

## Overview of package

This package allows you to simulate time series of environmental health data and
perform simulation-based power analyses and other measures of model performance.
The package can be thought of as including four main parts: exposure data 
generation, outcome data generation, fitting models, and evaluating models.
The user has the option to customize different aspects of the simulation at each
of the four steps.

## Basic example of using the package

You can use the eesim function to generate data, fit models, and assess the 
models. Using the eesim function is the most efficient way to make use of this 
package as this one function performs all four main steps of the package.  The 
eesim function returns a slope estimate, standard error, t- and p-values, and 
upper and lower 95% confidence bounds for each set of data simulated.  The 
function also returns some measures of model assessment, including the mean beta
and relative risk estimates across simulations.

```{r, warning = FALSE, message = FALSE}
ex_sim <- eesim(n_reps = 3, n = 10, central = 100, sd = 10,
                exposure_type = "continuous", exposure_trend = "cos1",
                exposure_amp = .6, average_outcome = 22, rr = 1.01,
                model = "spline", df_year = 1)
ex_sim
```

##Piece-by-piece breakdown of package utility

To demonstrate how eesim works, here is a breakdown of each of the four main 
parts: exposure, outcome, fitting models, and evaluating models.

###Generating exposure data

The first section of the package is designed to generate air pollution 
exposure data (or potentially other types of exposure) that may have seasonal 
trends. The user can specify whether they would like the exposure data to be
binary or continuous, and what kind of trend they would like the data to 
exhibit. We have built in several seasonal trends to choose from, which differ 
slightly depending on whether binary or continuous data is desired.

Below are plots of the built-in trends for continuous exposure data the user may
choose from. The trend options are similar for binary exposure, but exclude 
"curvilinear" and "cos1linear" and include a "monthly" trend, for which the user
enters a vector of 12 probabilities of exposure, one for each month.

```{r fig.width = 7, fig.height = 4, echo = FALSE, message = FALSE}
library(dplyr)
library(tidyr)
library(ggplot2)

data.frame(day = 1:1000) %>%
  mutate(none = calc_t(n = 1000, trend = "no trend"),
         cos1 = calc_t(n = 1000, trend = "cos1"),
         cos2 = calc_t(n = 1000, trend = "cos2"),
         cos3 = calc_t(n = 1000, trend = "cos3"),
         linear = calc_t(n = 1000, trend = "linear"),
         curvilinear = calc_t(n = 1000, trend = "curvilinear"),
         cos1linear = calc_t(n = 1000, trend = "cos1linear")) %>%
  gather(trend_method, trend_value, -day) %>%
  ggplot(aes(x = day, y = trend_value)) + 
  geom_line() + facet_wrap(~ trend_method, ncol = 4) + 
  theme_bw()
```

Here is an example of generating continuous exposure data with a "cos1linear"" 
trend:

```{r}
testexp <- sim_exposure(n=1000, central = 50, sd = 5, trend = "cos1linear",
                        amp = .6, exposure_type = "continuous")
qplot(testexp$date, testexp$x)+geom_point()+coord_cartesian(ylim = c(0,110))
```

The default amplitude for the trend is .6, but we can adjust the "amp" parameter
for a smaller or larger trend amplitude:

```{r}
smallamp <- sim_exposure(n=1000, central = 50, sd = 5, trend = "cos1linear",
                        amp = .3, exposure_type = "continuous")
qplot(smallamp$date, smallamp$x)+geom_point()+coord_cartesian(ylim = c(0,110))
```

Here is an example of generating binary exposure data with a "monthly" trend:

```{r}
testbin <- sim_exposure(n=400, central = c(.1,.1,.2,.3,.4,.4,.5,.6,.5,.3,.2,.1), trend = "monthly", exposure_type = "binary")
qplot(testbin$date, testbin$x)+geom_point()
```

## Comparing two models

As a basic example, you can use this package to simulate a continuous environmental exposure with seasonal and year-round trends and a count outcome. You can then fit a case-crossover and GLM model to this data and compare performance.


## More detailed examples
